FROM node:20.2.0

RUN npm install -g npm@9.8.0

WORKDIR /app/

COPY ./package*.json ./
RUN npm ci --omit=dev

COPY ./src/ ./src/
COPY ./astro.config.mjs ./
COPY ./tsconfig.json ./
RUN npm run build

EXPOSE 4001

CMD node ./dist/server/entry.mjs
